<kt-portlet>
  <kt-portlet-header [icon]="'fas fa-filter'" [title]="'Tìm kiếm'" [class]="'card-head-lg'"
    (click)="isCollapsed = !isCollapsed">
    <ng-container ktPortletTools>
      <i [hidden]="isCollapsed" class="fas fa-angle-double-down"></i>
      <i [hidden]="!isCollapsed" class="fas fa-angle-double-up"></i>
    </ng-container>
  </kt-portlet-header>

  <kt-portlet-body *ngIf="isCollapsed">
    <form class="row" [formGroup]="formSearch">
      <div class="col-lg-12">
        <div class="search-box-header">
          <label class="col-form-label">Tên cán bộ:</label>
          <div style="width: 50%;">
            <input autocomplete="off" (focusout)="trimSpace('user')" name="keyword" type="text" formControlName="user"
              class="form-control form-control-solid" placeholder="Nhập tên cán bộ" (keyup.enter)="search()">
            <div *ngIf="submitted && f.user.errors || f.user.errors && (f.user.dirty || f.user.touched)">
              <div class="text-error">
                <div *ngIf="f.user.errors.maxlength">
                  Tên cán bộ tối đa 100 ký tự!
                </div>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-primary ml-5" (click)="search()">
            Tìm kiếm
          </button>
          <!-- <button type="button" class="btn bnt-res" (click)="reset()">
            Reset
          </button> -->
        </div>
      </div>
    </form>
  </kt-portlet-body>
</kt-portlet>

<kt-portlet>
  <kt-portlet-header [icon]="'fa fa-list'" [title]="'Danh sách người dùng'" [class]="'card-head-lg'">
    <ng-container ktPortletTools></ng-container>
  </kt-portlet-header>
  <kt-portlet-body>
    <kendo-grid *ngIf="isLoading$ | async" [pageSize]="_pageSize" [pageable]="true" [kendoGridSelectBy]="'id'"
      [skip]="skip" [data]="gridView" [sortable]="true" [reorderable]="true" [resizable]="true" [height]="500"
      (selectedKeysChange)="getIdDelete($event)" [style]="{'border-radius': '25px'}" (pageChange)="pageChange($event)">

      <kendo-grid-checkbox-column [width]="45" [resizable]="false" [columnMenu]="false" showSelectAll="true">
          </kendo-grid-checkbox-column>

          <kendo-grid-column class="text-center"  headerClass="text-center font-weight-bold" title="TT" [width]="60">
            <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">{{rowIndex + 1}}
            </ng-template>
        </kendo-grid-column>

      <kendo-grid-column headerClass="text-center font-weight-bold" [width]="200" field="userName" editor="text" title="Tên cán bộ"></kendo-grid-column>
      <kendo-grid-column headerClass="text-center font-weight-bold" [width]="200" field="email" editor="text" title="Email"></kendo-grid-column>
      <kendo-grid-column  headerClass="text-center font-weight-bold" [width]="180" field="phoneNumber" editor="text" title="Số điện thoại"></kendo-grid-column>

      <kendo-grid-column headerClass="text-center font-weight-bold" field="isActive" editor="text" title="Trạng thái" [width]="150">
        <ng-template kendoGridCellTemplate let-dataItem>
          {{viewStatus(dataItem)}}
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-command-column headerClass="text-center font-weight-bold" title="Thao tác" [width]="120" [resizable]="false" sortable="false"
        [columnMenu]="false">
        <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem>
          <div class="d-flex justify-content-around align-items-center">
            <button ngbTooltip="Phân quyền" container="body" placement="left" kendoGridEditCommand
              *ktPermission="UserPemiss" (click)="settingRole(dataItem)" >
              <i class="fas fa-user-cog"></i>
            </button>
            <button ngbTooltip="Thay đổi khoá" container="body" placement="left" kendoGridEditCommand
              *ktPermission="UserPemiss" (click)="settingLockoutUser($event,dataItem)">
              <i class="fas fa-user-clock" style="color: #4b9da4;"></i>
            </button>
            <button  *ktPermission="UserPemiss" ngbTooltip="Đặt lại mật khẩu " container="body" placement="left" kendoGridEditCommand
              (click)="resetPassword($event,dataItem)"><i class="fas fas fa-key" style="color: chocolate"></i></button>
          </div>
        </ng-template>
      </kendo-grid-command-column>



      <ng-template kendoPagerTemplate let-currentPage="currentPage" let-total="total" let-skip="skip"
        let-pageSize="pageSize">
        <div class="d-lg-flex d-md-block justify-content-between w-100">
          <div class="p-1 d-flex d-sm-flex justify-content-between">
            <kendo-dropdownlist style="width: 60px;" [data]="pageSizes" [defaultItem]="5" [(ngModel)]="_pageSize"
              (ngModelChange)="pageSizeChange()">
            </kendo-dropdownlist>
            <p class="m-0 pl-3 pt-2">Tổng số: {{total}}. Hiển thị {{skip + 1}}
              - {{pageSize * currentPage >= total ? total : pageSize * currentPage}}</p>
          </div>
          <div class="d-flex justify-content-center custom-mt-15">
            <kendo-pager-prev-buttons></kendo-pager-prev-buttons>
            <kendo-pager-numeric-buttons [buttonCount]="10"></kendo-pager-numeric-buttons>
            <kendo-pager-next-buttons></kendo-pager-next-buttons>
          </div>
        </div>
      </ng-template>
      <ng-template kendoGridNoRecordsTemplate>
        Không có dữ liệu
      </ng-template>
    </kendo-grid>
    <div class="custom-loading-h">
      <div *ngIf="isloading" class="k-i-loading"></div>
    </div>
  </kt-portlet-body>
</kt-portlet>
